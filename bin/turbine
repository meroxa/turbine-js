#! /usr/bin/env node

if (process.env.NODE_ENV === "development") {
  require("dotenv").config();
}

const args = process.argv.slice(2);

const { listFunctions, runAppLocal, runAppPlatform } = require("../lib/runner");
const { generate } = require("../lib/utils");

async function executeCommand() {
  if (args[0] === "test") {
    // meroxa apps run
    commandRun = await runAppLocal(args[1] || process.cwd());
  } else if (args[0] === "deploy") {
    // meroxa apps deploy
    commandRun = await runAppPlatform(args[1] || process.cwd());
  } else if (args[0] === "generate") {
    // meroxa apps init
    commandRun = await generate(args[1], args[2]);
  } else if (args[0] === "functions") {
    commandRun = await listFunctions(args[1] || process.cwd());
    if (!commandRun.err) {
      console.log(commandRun.val);
    }
  } else {
    throw new Error("Invalid turbine command");
  }

  if (commandRun.err) {
    process.exitCode = 1;
    console.error(commandRun.val.unwrapMessage());
  }
}

executeCommand();
