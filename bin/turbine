#! /usr/bin/env node

if (process.env.NODE_ENV === "development") {
  require("dotenv").config();
}

const args = process.argv.slice(2);

const { run, listFunctions } = require("../lib/runner");
const { generate } = require("../lib/utils");

async function executeCommand() {
  let commandRun;
  if (args[0] === "test") {
    commandRun = await run("local", null, args[1]);
  } else if (args[0] === "deploy") {
    commandRun = await run("platform", "docker-local", args[1]);
  } else if (args[0] === "generate") {
    return generate(args[1], args[2]);
  } else if (args[0] === "functions") {
    commandRun = await listFunctions(args[1] || process.cwd());
    if (commandRun.val) {
      console.log(commandRun.val);
    }
  } else {
    throw new Error("Invalid turbine command");
  }

  if (commandRun.err) {
    console.error(commandRun.val.unwrapMessage());
  }
}

executeCommand();
